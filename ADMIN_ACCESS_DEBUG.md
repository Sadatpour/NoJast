# راهنمای عیب‌یابی مشکل دسترسی ادمین

این راهنما به شما کمک می‌کند مشکل دسترسی به پنل ادمین را عیب‌یابی و حل کنید.

## ۱. چک کردن صفحه تست دسترسی ادمین

ابتدا به این آدرس بروید:
```
/admin/debug/admin-test
```

این صفحه اطلاعات مفیدی در مورد وضعیت کاربر فعلی و مجوزهای ادمین ارائه می‌دهد. صفحه تست برای هر کاربری که وارد سیستم شده باشد قابل دسترسی است، حتی اگر ادمین نباشد.

### اقدامات لازم در صفحه تست:

- اگر صفحه تست باز نمی‌شود، به این معنی است که مشکل اصلی در احراز هویت است.
- اگر صفحه باز می‌شود، اطلاعات کاربر و وضعیت ادمین بودن را بررسی کنید.
- اگر `is_admin` روی `false` است، می‌توانید با دکمه "ادمین کردن" آن را تغییر دهید.

## ۲. بررسی و اصلاح دیتابیس

اگر ستون `is_admin` در دیتابیس وجود ندارد، باید آن را اضافه کنید:

1. به پنل مدیریت Supabase خود بروید: https://supabase.com/dashboard/project/xfckkfrfkwiymksbqnjn/sql
2. یک Query جدید ایجاد کنید و این دستور SQL را اجرا کنید:

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_admin BOOLEAN NOT NULL DEFAULT false;
```

3. برای تست صحت عملیات، این دستور را اجرا کنید:

```sql
SELECT id, email, username, full_name, is_admin FROM users;
```

## ۳. تبدیل کاربر به ادمین از طریق SQL

اگر با دکمه "ادمین کردن" در صفحه تست موفق نشدید، می‌توانید مستقیماً از SQL استفاده کنید:

1. ابتدا ID کاربر خود را از صفحه تست یادداشت کنید.
2. در SQL Editor این دستور را اجرا کنید (ID را جایگزین کنید):

```sql
UPDATE users SET is_admin = true WHERE id = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
```

3. با این دستور بررسی کنید که تغییرات اعمال شده‌اند:

```sql
SELECT id, email, username, full_name, is_admin FROM users WHERE is_admin = true;
```

## ۴. مشکلات احتمالی کوکی و نشست کاربری

گاهی کوکی‌ها و نشست‌های قبلی می‌توانند باعث مشکل شوند:

1. از مرورگر خارج شوید.
2. کوکی‌های مرورگر را پاک کنید (از منوی تنظیمات مرورگر).
3. مرورگر را کاملاً ببندید و دوباره باز کنید.
4. دوباره وارد سایت شوید.
5. به آدرس `/admin` بروید.

## ۵. بررسی تنظیمات Supabase

اطمینان حاصل کنید که متغیرهای محیطی Supabase به درستی تنظیم شده‌اند:

1. آیا `NEXT_PUBLIC_SUPABASE_URL` و `NEXT_PUBLIC_SUPABASE_ANON_KEY` به درستی تنظیم شده‌اند؟
2. تنظیمات Supabase خود را در آدرس https://supabase.com/dashboard/project/xfckkfrfkwiymksbqnjn/settings/api بررسی کنید.

## ۶. راه‌اندازی مجدد برنامه

راه‌اندازی مجدد برنامه می‌تواند به حل مشکلات کمک کند:

1. سرور برنامه را متوقف کنید.
2. سرور را دوباره راه‌اندازی کنید.
3. صفحه مرورگر را رفرش کنید.

## ۷. چک لیست نهایی

مراحل زیر را به ترتیب بررسی کنید:

- [ ] ستون `is_admin` در جدول `users` وجود دارد
- [ ] حداقل یک کاربر با `is_admin = true` در دیتابیس وجود دارد
- [ ] کاربر شما وارد سیستم شده (احراز هویت)
- [ ] کوکی‌ها و نشست‌های کاربری پاک و دوباره راه‌اندازی شده‌اند
- [ ] می‌توانید به صفحه تست `/admin/debug/admin-test` دسترسی داشته باشید
- [ ] متغیرهای محیطی Supabase به درستی تنظیم شده‌اند
- [ ] پس از اطمینان از موارد بالا، سعی کنید به آدرس `/admin` دسترسی پیدا کنید 